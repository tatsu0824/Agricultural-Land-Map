<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>sheet2gmap</title>
    <style>
      #map { height: 100%; }
      html, body { height: 100%; margin: 0; padding: 0; }
      #sidebar {
        position: absolute;
        top: 10%;
        left: 72%;
        width: 25%;
        height: 40%;
        border: 1px solid #666;
        padding: 6px;
        background-color: white;
        font-family: Meriyo UI;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="sidebar"></div>
    <script>
      const SHEET_ID = "1d2Nqzht-0CZiLu5HTtz3Xu8EoBidxF31K9BxobooriQ"; // スプレッドシートID
      const API_KEY = "AIzaSyAkSgFV_KFMsDDtmUicp9udYCiTAeIVR5o";   // Google Cloud APIキー

      function parseData(data) {
        if (!data || !data.values || data.values.length === 0) {
          console.error('No data found in the spreadsheet');
          return [];
        }
        var keys = data.values[0];
        var markerData = [];
        data.values.forEach(function(value, i) {
          if (i > 0) {
            var hash = {};
            value.forEach(function(d, j) {
              hash[keys[j]] = d;
            });
            markerData.push(hash);
          }
        });
        return markerData;
      }

      function initMap() {
        var target = document.getElementById('map');
        var centerp = {lat: 35.6679191, lng: 139.4606805};

        map = new google.maps.Map(target, {
          center: centerp,
          zoom: 7,
        });

        var request = new XMLHttpRequest();
        request.open('GET', `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/sheet1?key=${API_KEY}`, true);
        request.responseType = 'json';

        request.onload = function () {
          if (this.status === 200) {
            var data = this.response;
            var markerData = parseData(data);
            setData(markerData);
          } else {
            console.error('Failed to load data: ', this.status, this.statusText);
          }
        };

        request.onerror = function () {
          console.error('Error during the request');
        };

        request.send();
      }

      function setData(markerData) {
        // サイドバーとマーカーの処理
      }
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=YOUR_API_KEY&callback=initMap"
      async
      defer>
    </script>
  </body>
</html>
